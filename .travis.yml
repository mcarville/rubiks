sudo: required
services: docker
language: java
before_install: export GIT_COMMIT_ID=$(git rev-parse --short HEAD) && echo $GIT_COMMIT_ID
script: mvn install
deploy:
  provider: releases
  skip-cleanup: true
  api_key: $GITHUB_TOKEN
  github-token: $GITHUB_TOKEN
  keep-history: true
  file: target/*
  file_glob: true
  on:
    branch: master
after_success: docker build -t mcarville/sandbox:rubiks_$GIT_COMMIT_ID .
deploy:
  provider: script
  script: bash docker_push
  on:
    branch: master